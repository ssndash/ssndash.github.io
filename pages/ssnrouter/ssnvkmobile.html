<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VK Lite Online</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />

    <style>
        /* --- СТИЛИ (DESIGN) --- */
        :root {
            --md-sys-color-primary: #0077FF;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-container: #EADDFF;
            --md-sys-color-background: #FDFBFF;
            --md-sys-color-surface: #FDFBFF;
            --md-sys-color-surface-variant: #E7E0EC;
            --md-sys-color-on-surface: #1C1B1F;
            --md-sys-color-outline: #79747E;
            --radius-l: 24px;
            --radius-m: 16px;
            --shadow: 0 4px 8px rgba(0,0,0,0.05);
            --nav-height: 80px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background-color: var(--md-sys-color-background);
            color: var(--md-sys-color-on-surface);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .hidden { display: none !important; }
        
        .btn {
            border: none; padding: 12px 24px; border-radius: 100px;
            font-weight: 500; font-size: 14px; cursor: pointer;
            transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: var(--md-sys-color-primary); color: #fff; box-shadow: var(--shadow); }
        .btn-text { background: transparent; color: var(--md-sys-color-primary); }
        
        .input-field {
            width: 100%; padding: 16px; background: var(--md-sys-color-surface-variant);
            border: none; border-radius: var(--radius-m); margin-bottom: 12px;
            font-size: 16px; outline: none; font-family: inherit;
        }

        /* Экран входа */
        #auth-screen {
            flex: 1; display: flex; flex-direction: column;
            justify-content: center; padding: 32px; text-align: center;
        }
        .logo { font-size: 32px; color: var(--md-sys-color-primary); margin-bottom: 24px; font-weight: bold; }

        /* Основной экран */
        #app-screen {
            flex: 1; display: flex; flex-direction: column; height: 100%; position: relative;
        }
        header {
            padding: 16px; display: flex; align-items: center; justify-content: space-between;
            background: rgba(253, 251, 255, 0.9); backdrop-filter: blur(10px); z-index: 10;
        }
        header h1 { margin: 0; font-size: 22px; font-weight: 500; }

        main { flex: 1; overflow-y: auto; padding: 0 16px 100px 16px; scroll-behavior: smooth; }

        /* Карточки постов */
        .card {
            background: #fff; border-radius: var(--radius-l); padding: 16px;
            margin-bottom: 16px; box-shadow: var(--shadow); border: 1px solid #f0f0f0;
        }
        .user-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; background: #eee; }
        .user-info h3 { margin: 0; font-size: 16px; }
        .user-info span { font-size: 12px; color: var(--md-sys-color-outline); }
        .post-content { font-size: 15px; line-height: 1.5; word-wrap: break-word; }

        /* Профиль */
        .profile-header { text-align: center; margin-top: 20px; }
        .profile-avatar { width: 100px; height: 100px; border-radius: 50%; margin-bottom: 12px; }

        /* Навигация */
        nav.bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-height);
            background: #fff; display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid #eee; z-index: 10;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: var(--md-sys-color-outline); font-size: 12px; width: 100%; padding: 10px 0; cursor: pointer;
        }
        .nav-item.active { color: var(--md-sys-color-primary); }
        .nav-item .material-symbols-rounded { font-size: 26px; }
        .nav-item.active .icon-container {
            background: var(--md-sys-color-container); padding: 4px 20px; border-radius: 16px;
        }

        /* Кнопка создания поста (FAB) */
        .fab {
            position: fixed; bottom: 90px; right: 16px;
            width: 56px; height: 56px; background: var(--md-sys-color-primary);
            color: #fff; border-radius: 16px; display: flex; align-items: center;
            justify-content: center; box-shadow: 0 6px 16px rgba(0,119,255,0.3);
            cursor: pointer; z-index: 9;
        }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="logo">VK Lite Online</div>
        <div id="login-form">
            <h2>Вход</h2>
            <input type="text" id="login-email" class="input-field" placeholder="Email">
            <input type="password" id="login-password" class="input-field" placeholder="Пароль">
            <button class="btn btn-primary" style="width:100%" id="btn-login">Войти</button>
            <button class="btn btn-text" style="width:100%; margin-top:10px" onclick="toggleAuth('register')">Нет аккаунта? Регистрация</button>
        </div>
        <div id="register-form" class="hidden">
            <h2>Регистрация</h2>
            <input type="text" id="reg-email" class="input-field" placeholder="Email">
            <input type="text" id="reg-name" class="input-field" placeholder="Ваше имя">
            <input type="password" id="reg-password" class="input-field" placeholder="Пароль">
            <button class="btn btn-primary" style="width:100%" id="btn-register">Создать аккаунт</button>
            <button class="btn btn-text" style="width:100%; margin-top:10px" onclick="toggleAuth('login')">Уже есть аккаунт? Войти</button>
        </div>
    </div>

    <div id="app-screen" class="hidden">
        <header>
            <h1 id="page-title">Новости</h1>
            <span class="material-symbols-rounded" id="btn-logout" style="cursor:pointer">logout</span>
        </header>

        <main id="main-content">
            </main>

        <div id="fab" class="fab" onclick="openPostModal()">
            <span class="material-symbols-rounded">edit</span>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="nav('feed')">
                <div class="icon-container"><span class="material-symbols-rounded">home</span></div>
                <span>Главная</span>
            </div>
            <div class="nav-item" onclick="nav('profile')">
                <div class="icon-container"><span class="material-symbols-rounded">person</span></div>
                <span>Профиль</span>
            </div>
        </nav>
    </div>

    <div id="post-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:100; display:flex; align-items:center; justify-content:center;">
        <div class="card" style="width:90%;">
            <h3>Новый пост</h3>
            <textarea id="new-post-text" class="input-field" rows="4" placeholder="Что у вас нового?"></textarea>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button class="btn btn-text" onclick="closePostModal()">Отмена</button>
                <button class="btn btn-primary" onclick="publishPost()">Отправить</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ==========================================
        // ВАШ КОНФИГ FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyA2gFsl_0RaaJPPAlqm_sWQLXREVx9guEc",
            authDomain: "ssn-vk.firebaseapp.com",
            databaseURL: "https://ssn-vk-default-rtdb.firebaseio.com",
            projectId: "ssn-vk",
            storageBucket: "ssn-vk.firebasestorage.app",
            messagingSenderId: "253456954880",
            appId: "1:253456954880:web:bff6a4a1767fd40a950ae5",
            measurementId: "G-T2VLPBWBGE"
        };
        // ==========================================

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        let currentUser = null;

        // Авто-вход
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-screen').classList.remove('hidden');
                window.nav('feed');
            } else {
                currentUser = null;
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('app-screen').classList.add('hidden');
            }
        });

        // Кнопки входа/регистрации
        document.getElementById('btn-register').addEventListener('click', async () => {
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-password').value;
            const name = document.getElementById('reg-name').value;
            try {
                const cred = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(cred.user, { 
                    displayName: name,
                    photoURL: 'https://ui-avatars.com/api/?background=random&name=' + name
                });
            } catch (e) { alert("Ошибка: " + e.message); }
        });

        document.getElementById('btn-login').addEventListener('click', () => {
            signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-password').value)
                .catch(e => alert(e.message));
        });

        document.getElementById('btn-logout').addEventListener('click', () => signOut(auth));

        // Логика интерфейса
        window.toggleAuth = (type) => {
            document.getElementById('login-form').classList.toggle('hidden', type === 'register');
            document.getElementById('register-form').classList.toggle('hidden', type === 'login');
        };

        window.nav = (page) => {
            const main = document.getElementById('main-content');
            document.getElementById('page-title').innerText = page === 'feed' ? 'Новости' : 'Профиль';
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            if(page === 'feed') document.querySelectorAll('.nav-item')[0].classList.add('active');
            else document.querySelectorAll('.nav-item')[1].classList.add('active');

            main.innerHTML = ''; 

            if (page === 'feed') {
                document.getElementById('fab').style.display = 'flex';
                // В этом состоянии посты могут не отображаться, если правила закрыты
                onValue(ref(db, 'posts'), (snapshot) => {
                    main.innerHTML = ''; 
                    const posts = [];
                    snapshot.forEach((c) => posts.push({ key: c.key, ...c.val() }));
                    posts.reverse().forEach(post => {
                        const el = document.createElement('div');
                        el.className = 'card';
                        el.innerHTML = `
                             <div class="user-header">
                                <img src="${post.authorPhoto || ''}" class="avatar">
                                <div class="user-info">
                                    <h3>${post.authorName}</h3>
                                    <span>${new Date(post.timestamp).toLocaleString()}</span>
                                </div>
                                ${post.uid === currentUser.uid ? `<span class="material-symbols-rounded" style="margin-left:auto;color:#aaa;cursor:pointer" onclick="deletePost('${post.key}')">delete</span>` : ''}
                            </div>
                            <div class="post-content">${post.content}</div>
                        `;
                        main.appendChild(el);
                    });
                });
            } else {
                document.getElementById('fab').style.display = 'none';
                main.innerHTML = `
                    <div class="profile-header">
                        <img src="${currentUser.photoURL}" class="profile-avatar">
                        <h2>${currentUser.displayName}</h2>
                        <p>${currentUser.email}</p>
                    </div>
                `;
            }
        };

        window.openPostModal = () => document.getElementById('post-modal').classList.remove('hidden');
        window.closePostModal = () => document.getElementById('post-modal').classList.add('hidden');
        
        window.publishPost = () => {
            const txt = document.getElementById('new-post-text').value;
            if(!txt) return;
            // Здесь может быть проблема, если currentUser == null или правила закрыты
            push(ref(db, 'posts'), {
                uid: currentUser.uid,
                authorName: currentUser.displayName,
                authorPhoto: currentUser.photoURL,
                content: txt,
                timestamp: Date.now()
            });
            document.getElementById('new-post-text').value = '';
            window.closePostModal();
        };

        window.deletePost = (key) => { if(confirm('Удалить?')) remove(ref(db, 'posts/' + key)); };
    </script>
</body>
</html>